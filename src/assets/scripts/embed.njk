---
permalink: 'embed.js'
---
class WebringBanner extends HTMLElement {

    // lookup table for available themes
    themes = {
      default: "assets/themes/default.json",
      dark: "assets/themes/dark.json",
      ugly: "assets/themes/ugly.json"
    }

    constructor() {
        super();

        this.ringtitle = '{{ meta.title }}';
        this.url = '{{ meta.url }}';
        this.image = this.url + '/assets/images/{{ meta.image }}';
        this.membercount = {{ members | length}};
        this.shadowObj = this.attachShadow({ mode: 'open' });
        
        fetch('{{meta.dataUrl}}')
          .then(response => response.json())
          .then(sites => {
            const siteIndex = sites.findIndex(
              (site) => site.url.includes(window.location.hostname)
            );

            this.previousUrl = siteIndex < 1 ? sites[sites.length - 1].url : sites[siteIndex - 1].url;
            this.nextUrl = siteIndex >= sites.length - 1 ? sites[0].url : sites[siteIndex + 1].url;
            
            this.render();
          });
    }

    static get observedAttributes() {
      return ['theme'];
    }

    getStyles() {
        return `
        <style>
          * {
            box-sizing: border-box;
          }
        
          :root {
            font-size: 100%;
          }

          :host {
            display: block;
            width: 100%;
            font-size: 16px;
            text-align: left;
          }
  
          .webring-banner {
            background-color: var(--background-color, #FFF);
            border: 1px solid var(--outer-border-color, #DDD);
            border-radius: 8px;
            box-shadow: 0 2px 4px 0 rgba(14, 30, 37, 0.12);
            max-width: 480px;
          }

          .webring-banner a {
            color: var(--href-color, #7b16ff);
            text-decoration: none;
          }

          .webring-banner a:hover,
          .webring-banner a:focus {
            color: var(--href-color-active, #6200e2);
            text-decoration: underline;
          }

          .webring-banner__header {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            position: relative;
            padding: 1rem;
            border-bottom: 1px solid var(--inner-border-color, #DDD);
          }

          .webring-banner__description {
            flex: 1 0 0%;
            padding-right: 2rem;
            color: var(--text-color, #444);
          }

          .webring-banner__image {
            display: block;
            width: 70px;
            height: 70px;
            margin-right: 1rem;
            border-radius: 50%;
          }

          .webring-banner_text {
            line-height:0%;
            -inkscape-font-specification:'Comfortaa, Normal';
            text-align:start
            font-weight="400";
            font-size="16.933";
            font-family="Comfortaa";
            letter-spacing="0" word-spacing="0";
          }

          .webring-banner__title {
            margin: 0;
            font-size: 1.5rem;
            font-weight: bold;
            line-height: 1.2;
          }

          .webring-banner__info {
            display: flex;
            justify-content: center;
            border-radius: 50%;
            border: 2px solid var(--inner-border-color, #DDD);
            width: 1.25rem;
            height: 1.25rem;
            line-height: 1.25rem;
            font-size: .75rem;
            text-align: center;
            color: #666;
            text-decoration: none;
            position: absolute;
            top: 1rem;
            right: 1rem;
          }

          .webring-banner__links {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            padding: 1rem;
            margin: 0;
          }

          .webring-banner__link.a {
            display: block;
            text-decoration: none;
            color: var(--href-color, #00ad9f);
          }

          .webring-banner__link--next {
            text-align: right;
          }

          @media (min-width:400px) {
            .webring-banner__link {
                min-width: 100px;
            }
            .webring-banner__info {
                align-items: center;
            }
          }
        </style>
      `;
    }

    getTemplate() {
        return `
          ${this.getStyles()}
          <div class="webring-banner">
            <div class="webring-banner__header">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" class="webring-banner__image">
                <path d="M22.46 17.354A14.645 14.645 0 007.814 32 14.645 14.645 0 0022.46 46.645a14.645 14.645 0 0014.046-10.5 4.061 4.061 0 01-1.69-.524 4.016 4.016 0 01-1.47-1.49c-.349-.645-.523-1.363-.523-2.155 0-.805.174-1.524.523-2.155a3.973 3.973 0 011.47-1.51 4.06 4.06 0 011.67-.522A14.645 14.645 0 0022.46 17.354z" 
                  fill="none" stroke="var(--text-color, #000001)" stroke-width=".76490078"/>
                <path class="webring-banner_text" d="M25.428 27.25q1.32 0 2.388.627 1.083.61 1.693 1.693.627 1.084.627 2.405 0 1.32-.61 2.404-.593 1.067-1.643 1.693-1.033.61-2.32.61-1.1 0-2.015-.457-.914-.474-1.507-1.287v4.961q0 .288-.186.475-.186.186-.474.186t-.474-.186q-.17-.187-.17-.475v-3.793q-.016-.05-.016-.152v-3.98q0-1.32.61-2.404.626-1.084 1.693-1.693 1.083-.627 2.404-.627zm0 8.247q.965 0 1.744-.457.796-.458 1.236-1.254.458-.812.458-1.811 0-1-.458-1.795-.44-.813-1.236-1.27-.779-.474-1.744-.474t-1.744.474q-.779.457-1.236 1.27-.44.796-.44 1.795 0 .287.016.423.017.034.017.085.17 1.32 1.101 2.167.948.847 2.286.847zM36.909 36.682q-1.338 0-2.422-.61-1.066-.61-1.676-1.676-.61-1.084-.61-2.421 0-1.338.61-2.422t1.676-1.693q1.084-.61 2.422-.61t2.404.61q1.067.61 1.677 1.693.626 1.084.626 2.422 0 1.337-.61 2.421-.609 1.067-1.693 1.676-1.066.61-2.404.61zm0-1.185q.982 0 1.76-.457.78-.458 1.22-1.254.44-.812.44-1.811 0-1.016-.44-1.812-.44-.813-1.22-1.27-.778-.457-1.76-.457-.965 0-1.761.457-.78.457-1.236 1.27-.44.796-.44 1.812 0 .999.44 1.811.457.796 1.236 1.254.796.457 1.76.457zM46.154 36.597q-1.033 0-1.693-.812-.643-.83-.643-2.117v-9.652q0-.288.186-.457.186-.187.457-.187.288 0 .457.187.186.17.186.457v9.652q0 .728.288 1.185.305.457.762.457h.424q.254 0 .406.187.152.17.152.457 0 .288-.22.474-.203.17-.542.17zM56.179 27.386q.39.152.39.49 0 .153-.068.306l-5.487 12.056q-.152.39-.49.39-.17 0-.306-.068-.39-.153-.39-.508 0-.153.069-.305l1.676-3.708v-.017l-3.776-7.824q-.068-.135-.068-.304 0-.356.373-.508.135-.068.305-.068.355 0 .508.356l3.302 6.96 3.15-6.944q.168-.372.507-.372.153 0 .305.068z"
                  fill="var(--text-color, #000001)"/>
              </svg>
              <div class="webring-banner__description">
                <span>This site is part of</span>
                <h3 class="webring-banner__title">
                  <a href="${this.url}">${this.ringtitle}</a>
                </h3>
                <span>A webring with ${this.membercount} members</span>
              </div>
              <a class="webring-banner__info" href="https://en.wikipedia.org/wiki/Webring" title="What's this?">?</a>
            </div>
            <p class="webring-banner__links">
              <a 
                href="${this.previousUrl}" 
                class="webring-banner__link webring-banner__link--prev" 
                aria-label="Go to previous site"
              >Previous</a>
              <a
                href="${this.nextUrl}"
                class="webring-banner__link webring-banner__link--next"
                aria-label="Go to next site"
              >Next</a>
            </p>
          </div>
        `;
    }

    render() {
        this.shadowObj.innerHTML = this.getTemplate();
    }

    attributeChangedCallback(attrName, oldVal, newVal) {
      if(attrName == "theme" && newVal && oldVal !== newVal) {
        var url = this.themes[newVal] ?? newVal;

        fetch(url).then(response => response.json())
            .then(val => {
                var item;
                for(item in val) {
                  this.style.setProperty(item, val[item]);
                }              
            }).catch( val => {
                console.error(val);
            });  
      }
    }

}

customElements.define('webring-banner', WebringBanner);
